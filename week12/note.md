# 进程间通信

进程间通信

进程之间协同工作时会需要交换数据，这就需要用到进程间通信`（Inter-Process Communication，IPC）`机制。UNIX中存在多种`IPC`机制，具体如下：

1. 匿名管道和FIFO有名管道

2. 消息队列、信号量和共享存储

3. 套接字

套接字既可用于同一台机器中不同程序之间的通信，也可用于网络通信。

## 1. 管道

管道的使用非常广泛，最常见的是在命令行中。

`$cat file |grep "pipe"|more`

### 1.1 创建管道

​	创建管道需调用`pipe()`函数。`pipe()`的唯一参数是一个由两个整数组成的数组，该数组调用成功后将含有作为管道使用的两个文件描述字，其中一个作为管道的输入，另一个做为管道的输出。

```c
#include <unistd.h>

int pipe(int fdes[2]);
```

​	当进程调用`pipe()`成功时,内核在系统内部将创建一条管道,并设置由该管道使用的两个已打开文件描述字于数组 `fdes`。其中`fdes[0]`设置为读而打开,是与输入端相连的文件描述字。`fdes[1]`设置为写而打开,是与输出端相连的文件描述字。

​	管道的用途在与父子进程间通信。

### 1.2 父子进程间的管道通信

​	如果进程在调用 `fork()`之前先调用 `pipe()`创建一个管道,则在`fork()`调用之后,父、子进程都能访问构成管道的这两个文件描述字。于是,可以利用管道在父子进程之间交换数据。图11-3说明了父、子进程之间共享一个管道的情形。

![](http://121.36.193.184:6789/imgs/2020/12/c4f3a0c9fab98a85.png)



​	从图11-3中可以看出管道有两种通信方向:一种是从父进程往子进程发送数据,另一种则反之。但是这两个通信方向**不能同时存在**,因为尽管父、子进程都可读自己所写的数据,但这样做的结果将导致混乱。

### 1.3 连接标准输入和标准输出的管道

`p330`

### 1.4 `popen()`和`pclose()`函数

C标准库中还有两个函数`popen()`和`pclose()`，它们提供了两个程序之间建立管道的最简单方法。

```c
#include <stdio.h>

FILE *popen(const char *command,const char *mode);
int pclose(FILE *stream);
```

​	`popen()`在调用进程与要执行的命令之间建立一个内部的半双工管道,然后派生一个子进程,并调用`exec()`启动 shell程序执行 command给出的命令,这有点像`system()`(6.6节)。但与 `system()`不同, `popen()`不等待命令完成,而是立即返回管道对应的流指针。

### 1.5 管道I/O的原子性

不超过缓冲区

## 2. FIFO文件

奇偶校验 奇校验



